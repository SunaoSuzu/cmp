
const template={"AWSTemplateFormatVersion":"2010-09-09","Description":"yamada3-vpc","Resources":{"vpc":{"Type":"AWS::EC2::VPC","Properties":{"EnableDnsSupport":true,"EnableDnsHostnames":true,"CidrBlock":"172.20.0.0/16","Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-vpc"}]}},"igw":{"Type":"AWS::EC2::InternetGateway","Properties":{"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-igw"}]}},"igwAttach":{"Type":"AWS::EC2::VPCGatewayAttachment","Properties":{"VpcId":{"Ref":"vpc"},"InternetGatewayId":{"Ref":"igw"}}},"publicRouteTable":{"Type":"AWS::EC2::RouteTable","Properties":{"VpcId":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-igw"}]}},"PublicRoute":{"Type":"AWS::EC2::Route","Properties":{"RouteTableId":{"Ref":"publicRouteTable"},"DestinationCidrBlock":"0.0.0.0/0","GatewayId":{"Ref":"igw"}}},"BastionSubnet":{"Type":"AWS::EC2::Subnet","Properties":{"AvailabilityZone":"ap-northeast-1a","CidrBlock":"172.20.5.0/24","MapPublicIpOnLaunch":true,"VpcId":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-public-subnet-bastion"}]}},"BastionSubnetRouteTableAssociation":{"Type":"AWS::EC2::SubnetRouteTableAssociation","Properties":{"SubnetId":{"Ref":"BastionSubnet"},"RouteTableId":{"Ref":"publicRouteTable"}}},"publicSubnet0":{"Type":"AWS::EC2::Subnet","Properties":{"AvailabilityZone":"ap-northeast-1a","CidrBlock":"172.20.1.0/24","MapPublicIpOnLaunch":true,"VpcId":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-public-subnet-1a"}]}},"publicSubnet0RouteTableAssociation":{"Type":"AWS::EC2::SubnetRouteTableAssociation","Properties":{"SubnetId":{"Ref":"publicSubnet0"},"RouteTableId":{"Ref":"publicRouteTable"}}},"publicSubnet0NatEip":{"Type":"AWS::EC2::EIP","Properties":{"Domain":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-public-subnet-1aNatEip"}]}},"publicSubnet0Nat":{"Type":"AWS::EC2::NatGateway","Properties":{"AllocationId":{"Fn::GetAtt":["publicSubnet0NatEip","AllocationId"]},"SubnetId":{"Ref":"publicSubnet0"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-public-subnet-1aNat"}]}},"publicSubnet1":{"Type":"AWS::EC2::Subnet","Properties":{"AvailabilityZone":"ap-northeast-1c","CidrBlock":"172.20.2.0/24","MapPublicIpOnLaunch":true,"VpcId":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-public-subnet-1c"}]}},"publicSubnet1RouteTableAssociation":{"Type":"AWS::EC2::SubnetRouteTableAssociation","Properties":{"SubnetId":{"Ref":"publicSubnet1"},"RouteTableId":{"Ref":"publicRouteTable"}}},"publicSubnet1NatEip":{"Type":"AWS::EC2::EIP","Properties":{"Domain":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-public-subnet-1cNatEip"}]}},"publicSubnet1Nat":{"Type":"AWS::EC2::NatGateway","Properties":{"AllocationId":{"Fn::GetAtt":["publicSubnet1NatEip","AllocationId"]},"SubnetId":{"Ref":"publicSubnet1"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-public-subnet-1cNat"}]}},"privateSubnet0":{"Type":"AWS::EC2::Subnet","Properties":{"AvailabilityZone":"ap-northeast-1a","CidrBlock":"172.20.3.0/24","MapPublicIpOnLaunch":false,"VpcId":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-private-subnet-1a"}]}},"privateSubnet0RouteTable":{"Type":"AWS::EC2::RouteTable","Properties":{"VpcId":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-private-subnet-1aRouteTable"}]}},"privateSubnet0Route":{"Type":"AWS::EC2::Route","Properties":{"RouteTableId":{"Ref":"privateSubnet0RouteTable"},"DestinationCidrBlock":"0.0.0.0/0","NatGatewayId":{"Ref":"publicSubnet0Nat"}}},"privateSubnet0RouteTableAssociation":{"Type":"AWS::EC2::SubnetRouteTableAssociation","Properties":{"SubnetId":{"Ref":"privateSubnet0"},"RouteTableId":{"Ref":"privateSubnet0RouteTable"}}},"privateSubnet1":{"Type":"AWS::EC2::Subnet","Properties":{"AvailabilityZone":"ap-northeast-1c","CidrBlock":"172.20.4.0/24","MapPublicIpOnLaunch":false,"VpcId":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-private-subnet-1c"}]}},"privateSubnet1RouteTable":{"Type":"AWS::EC2::RouteTable","Properties":{"VpcId":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-private-subnet-1cRouteTable"}]}},"privateSubnet1Route":{"Type":"AWS::EC2::Route","Properties":{"RouteTableId":{"Ref":"privateSubnet1RouteTable"},"DestinationCidrBlock":"0.0.0.0/0","NatGatewayId":{"Ref":"publicSubnet1Nat"}}},"privateSubnet1RouteTableAssociation":{"Type":"AWS::EC2::SubnetRouteTableAssociation","Properties":{"SubnetId":{"Ref":"privateSubnet1"},"RouteTableId":{"Ref":"privateSubnet1RouteTable"}}},"vpcInternalDns":{"Type":"AWS::Route53::HostedZone","Properties":{"HostedZoneConfig":{"Comment":"internal dns for yamada3-vpc"},"Name":"yamada3.sutech.internal","VPCs":[{"VPCId":{"Ref":"vpc"},"VPCRegion":"ap-northeast-1"}]}},"vpcEndPointS3":{"Type":"AWS::EC2::VPCEndpoint","Properties":{"RouteTableIds":[{"Ref":"privateSubnet0RouteTable"},{"Ref":"privateSubnet1RouteTable"},{"Ref":"publicRouteTable"}],"ServiceName":{"Fn::Sub":"com.amazonaws.${AWS::Region}.s3"},"VpcId":{"Ref":"vpc"}}},"vpcEndPointLogs":{"Type":"AWS::EC2::VPCEndpoint","Properties":{"VpcEndpointType":"Interface","PrivateDnsEnabled":"true","SubnetIds":[{"Ref":"publicSubnet0"},{"Ref":"publicSubnet1"}],"SecurityGroupIds":[{"Ref":"landscapeGroup"}],"ServiceName":{"Fn::Sub":"com.amazonaws.${AWS::Region}.logs"},"VpcId":{"Ref":"vpc"}}},"vpcEndPointMonitoring":{"Type":"AWS::EC2::VPCEndpoint","Properties":{"VpcEndpointType":"Interface","PrivateDnsEnabled":"true","SubnetIds":[{"Ref":"publicSubnet0"},{"Ref":"publicSubnet1"}],"SecurityGroupIds":[{"Ref":"landscapeGroup"}],"ServiceName":{"Fn::Sub":"com.amazonaws.${AWS::Region}.monitoring"},"VpcId":{"Ref":"vpc"}}},"vpcEndPointEvents":{"Type":"AWS::EC2::VPCEndpoint","Properties":{"VpcEndpointType":"Interface","PrivateDnsEnabled":"true","SubnetIds":[{"Ref":"publicSubnet0"},{"Ref":"publicSubnet1"}],"SecurityGroupIds":[{"Ref":"landscapeGroup"}],"ServiceName":{"Fn::Sub":"com.amazonaws.${AWS::Region}.events"},"VpcId":{"Ref":"vpc"}}},"vpcEndPointEFS":{"Type":"AWS::EC2::VPCEndpoint","Properties":{"VpcEndpointType":"Interface","PrivateDnsEnabled":"true","SubnetIds":[{"Ref":"publicSubnet0"},{"Ref":"publicSubnet1"}],"SecurityGroupIds":[{"Ref":"landscapeGroup"}],"ServiceName":{"Fn::Sub":"com.amazonaws.${AWS::Region}.elasticfilesystem"},"VpcId":{"Ref":"vpc"}}},"bastionSecurityGroup":{"Type":"AWS::EC2::SecurityGroup","Properties":{"VpcId":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-sg-bastion"}],"GroupName":"yamada3-sg-bastion","GroupDescription":"for bastion ec2"}},"sshFromBastion":{"Type":"AWS::EC2::SecurityGroup","Properties":{"VpcId":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-sg-ssh-from-bastion"}],"GroupName":"yamada3-sg-ssh-from-bastion","GroupDescription":"for ssh from bastion"}},"webPublishSecurityGroup":{"Type":"AWS::EC2::SecurityGroup","Properties":{"VpcId":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-sg-web-publish"}],"GroupName":"yamada3-sg-web-publish","GroupDescription":"for web-publish of ap"}},"landscapeGroup":{"Type":"AWS::EC2::SecurityGroup","Properties":{"VpcId":{"Ref":"vpc"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"landscapeGroup"}],"GroupName":"landscapeGroup","GroupDescription":"for grouping landscape"}},"bastionSecurityGroupIngress0":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"GroupId":{"Ref":"bastionSecurityGroup"},"IpProtocol":"TCP","FromPort":22,"ToPort":22,"SourceSecurityGroupId":{"Ref":"bastionSecurityGroup"}}},"bastionSecurityGroupIngress1":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"GroupId":{"Ref":"bastionSecurityGroup"},"IpProtocol":"TCP","FromPort":22,"ToPort":22,"CidrIp":"118.240.151.69/32"}},"sshFromBastionIngress0":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"GroupId":{"Ref":"sshFromBastion"},"IpProtocol":"TCP","FromPort":22,"ToPort":22,"SourceSecurityGroupId":{"Ref":"bastionSecurityGroup"}}},"webPublishSecurityGroupIngress0":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"GroupId":{"Ref":"webPublishSecurityGroup"},"IpProtocol":"TCP","FromPort":80,"ToPort":80,"CidrIp":"0.0.0.0/0"}},"webPublishSecurityGroupIngress1":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"GroupId":{"Ref":"webPublishSecurityGroup"},"IpProtocol":"TCP","FromPort":443,"ToPort":443,"CidrIp":"0.0.0.0/0"}},"landscapeGroupIngress0":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"GroupId":{"Ref":"landscapeGroup"},"IpProtocol":"-1","FromPort":-1,"ToPort":-1,"SourceSecurityGroupId":{"Ref":"landscapeGroup"}}},"BastionEc2":{"Type":"AWS::EC2::Instance","Properties":{"ImageId":"ami-0db8ca4897909ac37","InstanceType":"t2.micro","KeyName":"sunao","SecurityGroupIds":[{"Ref":"bastionSecurityGroup"}],"SubnetId":{"Ref":"BastionSubnet"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3-ec2-ap-bastion"}],"UserData":{"Fn::Base64":"ls -l"}}},"ALB":{"Type":"AWS::ElasticLoadBalancingV2::LoadBalancer","Properties":{"Scheme":"internet-facing","Subnets":[{"Ref":"publicSubnet0"},{"Ref":"publicSubnet1"}],"LoadBalancerAttributes":[{"Key":"idle_timeout.timeout_seconds","Value":"3600"},{"Key":"access_logs.s3.enabled","Value":"true"},{"Key":"access_logs.s3.bucket","Value":"logs.test.sutech"},{"Key":"access_logs.s3.prefix","Value":"elb/yamada3-lb"}],"SecurityGroups":[{"Ref":"webPublishSecurityGroup"}],"Name":"yamada3-lb"}},"ALBListener":{"Type":"AWS::ElasticLoadBalancingV2::Listener","Properties":{"Certificates":[{"CertificateArn":"arn:aws:acm:ap-northeast-1:510229950882:certificate/8d7b9200-8285-4869-8014-031c45dbd5a5"}],"DefaultActions":[{"Type":"fixed-response","FixedResponseConfig":{"ContentType":"text/plain","MessageBody":"Page Not Found","StatusCode":"404"}}],"LoadBalancerArn":{"Ref":"ALB"},"Port":443,"Protocol":"HTTPS","SslPolicy":"ELBSecurityPolicy-TLS-1-2-2017-01"}},"RyoSpringApLaunch":{"Type":"AWS::AutoScaling::LaunchConfiguration","Properties":{"ImageId":"ami-08cb2a57735400567","KeyName":"sunao","InstanceType":"t2.micro","UserData":{"Fn::Base64":"#!/bin/bash\ncd /var/tmp/\nbash start.sh\n"},"SecurityGroups":[{"Ref":"webPublishSecurityGroup"},{"Ref":"sshFromBastion"}]}},"RyoSpringApAuto":{"Type":"AWS::AutoScaling::AutoScalingGroup","Properties":{"LaunchConfigurationName":{"Ref":"RyoSpringApLaunch"},"MinSize":1,"MaxSize":1,"TargetGroupARNs":[{"Ref":"RyoSpringApTargetGroup"}],"MetricsCollection":[{"Granularity":"1Minute","Metrics":["GroupMinSize","GroupMaxSize"]}],"VPCZoneIdentifier":[{"Ref":"privateSubnet0"},{"Ref":"privateSubnet1"}],"Tags":[{"Value":"yamada","Key":"tenant","PropagateAtLaunch":true},{"Value":"yamada","Key":"landscape","PropagateAtLaunch":true},{"PropagateAtLaunch":true,"Key":"Name","Value":"yamada3spring-ap"}]},"UpdatePolicy":{"AutoScalingRollingUpdate":{"MaxBatchSize":1,"MinInstancesInService":0,"PauseTime":"PT15M","SuspendProcesses":["AlarmNotification"],"WaitOnResourceSignals":true}}},"RyoSpringApTargetGroup":{"Type":"AWS::ElasticLoadBalancingV2::TargetGroup","Properties":{"HealthCheckIntervalSeconds":30,"HealthCheckTimeoutSeconds":29,"UnhealthyThresholdCount":2,"HealthyThresholdCount":2,"HealthCheckPath":"/currentversion","HealthCheckProtocol":"HTTP","HealthCheckPort":"80","Matcher":{"HttpCode":"200"},"Name":"yamada3spring-ap-targetGroup","Port":80,"Protocol":"HTTP","TargetType":"instance","TargetGroupAttributes":[{"Key":"stickiness.enabled","Value":"true"},{"Key":"stickiness.lb_cookie.duration_seconds","Value":"1800"}],"VpcId":{"Ref":"vpc"}}},"RyoSpringApListerRule":{"Type":"AWS::ElasticLoadBalancingV2::ListenerRule","Properties":{"Actions":[{"Type":"forward","TargetGroupArn":{"Ref":"RyoSpringApTargetGroup"}}],"Conditions":[{"Field":"host-header","Values":[{"Fn::GetAtt":["ALB","DNSName"]},"yamada3-spring.sutech.co.jp","spring-ap.yamada3.sutech.internal"]}],"ListenerArn":{"Ref":"ALBListener"},"Priority":10}},"RyoSpringDb":{"Type":"AWS::EC2::Instance","Properties":{"ImageId":"ami-03e4521d84f084007","KeyName":"sunao","BlockDeviceMappings":[{"DeviceName":"/dev/sdg","Ebs":{"VolumeSize":"1","VolumeType":"gp2"}}],"InstanceType":"t2.micro","UserData":{"Fn::Base64":"ls -l"},"SecurityGroupIds":[{"Ref":"webPublishSecurityGroup"},{"Ref":"landscapeGroup"},{"Ref":"sshFromBastion"}],"SubnetId":{"Ref":"privateSubnet0"},"Tags":[{"Value":"yamada","Key":"tenant"},{"Value":"yamada","Key":"landscape"},{"Key":"Name","Value":"yamada3spring-db"}]}},"RyoSpringDbPrivateDNS":{"Type":"AWS::Route53::RecordSet","DependsOn":"vpcInternalDns","Properties":{"HostedZoneName":"yamada3.sutech.internal.","Comment":"DNS name for DB","Name":"spring-db.yamada3.sutech.internal","Type":"CNAME","TTL":"300","ResourceRecords":[{"Fn::GetAtt":["RyoSpringDb","PrivateDnsName"]}]}},"RyoSpringApPublicDNS":{"Type":"AWS::Route53::RecordSet","DependsOn":"RyoSpringApListerRule","Properties":{"HostedZoneName":"sutech.co.jp.","Comment":"DNS name for ALB","Name":"yamada3-spring.sutech.co.jp","Type":"CNAME","TTL":"300","ResourceRecords":[{"Fn::GetAtt":["ALB","DNSName"]}]}}}};
const command   = require("./CreateStackCommand");
const region = require("../../conf/Region");

command.changeSet({region: region.name},"yamada3-vpc","yamada3-vpc-new",JSON.stringify(template));
